(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-737a4292"],{"105d":function(t,e,r){},2598:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"main_box"},[r("div",{staticClass:"top_box"}),r("div",{staticClass:"search_box"},[r("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"输入关键词查询",search:""},model:{value:t.filter_keyword,callback:function(e){t.filter_keyword=e},expression:"filter_keyword"}}),r("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:t.showModal}},[t._v("新增角色")])],1),r("div",{staticStyle:{"margin-top":"20px"}},[r("Row",{attrs:{gutter:16}},[r("Col",{attrs:{span:"16"}},[r("Card",{staticStyle:{width:"100%"}},[r("p",{attrs:{slot:"title"},slot:"title"},[t._v("\n            角色列表\n          ")]),r("Table",{attrs:{"highlight-row":"",columns:t.columns,data:t.roleList,loading:t.loading},on:{"on-current-change":t.selectTable},scopedSlots:t._u([{key:"action",fn:function(e){var n=e.row;e.index;return[r("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"warning",size:"small"},on:{click:function(e){t.editModal(n)}}},[t._v("编辑")]),r("Poptip",{attrs:{confirm:"",title:"确定删除此角色"},on:{"on-ok":function(e){t.remove(n)}}},["超级管理员"!==n.name?r("Button",{attrs:{type:"error",size:"small"}},[t._v("删除")]):t._e()],1)]}}])}),r("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[r("Page",{attrs:{total:t.order_total,"show-total":""}})],1)],1)],1),r("Col",{attrs:{span:"8"}},["菜单分配"==t.current_radio?r("Card",{staticStyle:{width:"100%"}},[r("p",{attrs:{slot:"title"},slot:"title"},[t._v("\n            "+t._s(t.current_table.role_name?"为 "+t.current_table.role_name+" 菜单分配":"菜单分配")+"\n          ")]),t.current_table?t._e():r("div",{staticClass:"cover_box"},[r("div",{staticClass:"cover_text_box"},[t._v("请选中角色后操作")])]),r("Divider",[t._v("功能")]),r("CheckboxGroup",{on:{"on-change":t.changeBtn},model:{value:t.btnTextList,callback:function(e){t.btnTextList=e},expression:"btnTextList"}},t._l(t.btn_list,function(t){return r("Checkbox",{attrs:{label:t.title,"true-value":t.path_name,border:""}})})),r("Divider",[t._v("菜单")]),r("Tree",{attrs:{data:t.menu_tree,"show-checkbox":"",multiple:""},on:{"on-check-change":t.changeTree}}),r("Button",{attrs:{slot:"extra",type:"primary"},on:{click:t.saveMenu},slot:"extra"},[t._v("保存")])],1):t._e()],1)],1)],1),r("Modal",{attrs:{"mask-closable":!1,title:t.isEdit?"编辑角色":"新增角色"},model:{value:t.modal_show,callback:function(e){t.modal_show=e},expression:"modal_show"}},[r("Form",{ref:"modalForm",attrs:{model:t.form_data,rules:t.user_rules,"label-width":80}},[r("FormItem",{attrs:{label:"角色名称",prop:"role_name"}},[r("Input",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:t.form_data.role_name,callback:function(e){t.$set(t.form_data,"role_name",e)},expression:"form_data.role_name"}})],1),r("FormItem",{attrs:{label:"描述"}},[r("Input",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:t.form_data.role_desc,callback:function(e){t.$set(t.form_data,"role_desc",e)},expression:"form_data.role_desc"}})],1)],1),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("Button",{on:{click:t.hideModal}},[t._v("取消")]),r("Button",{attrs:{type:"primary"},on:{click:function(e){t.saveBtn("modalForm")}}},[t._v("保存")])],1)],1)],1)},a=[],i=r("be94"),s=(r("96cf"),r("1da1")),o=(r("7f7f"),r("0a21"),{name:"user",data:function(){var t=function(t,e,r){""===e?r(new Error("请输入角色名称")):"超级管理员"===e?r(new Error("不允许创建此角色")):r()};return{loading:!1,modal_show:!1,isEdit:!1,form_data:{role_name:"",role_desc:""},user_rules:{role_name:[{validator:t,trigger:"blur"}]},roleList:[],page:1,page_size:10,count:0,current_table:"",current_radio:"菜单分配",menu_tree:[],btn_list:[{title:"新增工单",path_name:"btn_addOrder"},{title:"新增客户",path_name:"btn_addCustomer"},{title:"新增设备",path_name:"btn_addDevice"},{title:"新增备件",path_name:"btn_addSpare"},{title:"地图报单",path_name:"btn_mapAddOrder"},{title:"派工",path_name:"btn_arrangeOrder"},{title:"处理工单",path_name:"btn_solveOrder"},{title:"编辑工单",path_name:"btn_editOrder"},{title:"删除工单",path_name:"btn_deleteOrder"},{title:"编辑客户",path_name:"btn_editCustomer"},{title:"删除客户",path_name:"btn_deleteCustomer"},{title:"编辑设备",path_name:"btn_editDevice"},{title:"删除设备",path_name:"btn_deleteDevice"},{title:"领用备件",path_name:"btn_getSpare"},{title:"入库备件",path_name:"btn_inSpare"},{title:"编辑备件",path_name:"btn_editSpare"},{title:"删除备件",path_name:"btn_deleteSpare"},{title:"备件审核",path_name:"btn_review"},{title:"备件拒绝",path_name:"btn_reject"}],menuList:[],btnTextList:[],btnList:[],filter_keyword:"",columns:[{title:"角色名称",key:"name",align:"center"},{title:"描述",key:"description",align:"center"},{title:"操作",slot:"action",width:130}],order_total:1,exportLoading:!1}},mounted:function(){this.getList(),this.getMenuList()},methods:{getMenuList:function(){var t=function t(e){return e.filter(function(t){return t.permission}).map(function(e){return e.children?{title:e.meta.title,path_name:e.name,children:t(e.children)}:{title:e.meta.title,path_name:e.name}})}(this.$router.options.routes);this.menu_tree=t},getList:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){var e,r,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,this.$service.role.getList({num:this.page,size:this.page_size});case 3:if(e=t.sent,r=e.err,n=e.data,this.loading=!1,!r){t.next=10;break}return this.$Message.error(r.message),t.abrupt("return");case 10:this.roleList=n.data.list,this.count=n.data.count;case 12:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),showModal:function(){this.isEdit=!1,this.modal_show=!0},saveBtn:function(t){var e=this;this.$refs[t].validate(function(t){t?e.isEdit||e.saveRole():e.$Message.error("请按要求输入")})},saveRole:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){var e,r,n,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e={name:this.form_data.role_name,description:this.form_data.role_desc},t.next=3,this.$service.role.addRole(e);case 3:if(r=t.sent,n=r.err,a=r.data,!n){t.next=9;break}return this.$Message.error(n.message),t.abrupt("return");case 9:this.modal_show=!1,this.$Message.success(a.message),this.getList();case 12:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),remove:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(e){var r,n,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$service.role.deleteRole(e.id);case 2:if(r=t.sent,n=r.err,a=r.data,!n){t.next=8;break}return this.$Message.error(n.message),t.abrupt("return");case 8:this.$Message.success(a.message),this.getList();case 10:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),editModal:function(t){this.modal_show=!0,this.isEdit=!0,this.form_data={role_name:t.name,role_desc:t.description}},selectTable:function(t,e){this.current_table=t,this.menuList=t.menulist.map(function(t){if(-1==t.indexOf("btn_"))return t}).filter(function(t){return t}),this.btnList=t.menulist.map(function(t){if(0==t.indexOf("btn_"))return t}).filter(function(t){return t}),this.checkRoleMenu(),this.checkBtnList()},checkBtnList:function(){var t=this;this.btnTextList=this.btn_list.map(function(e){if(t.current_table.menulist.indexOf(e.path_name)>-1)return e.title}).filter(function(t){return t})},changeTree:function(t){if(this.current_table){var e=[];(function(t){t.map(function(t){t.children||e.push(t.path_name)})})(t);this.menuList=e}else this.$Message.error("请先选择角色")},changeBtn:function(t){this.btnList=this.btn_list.map(function(e){if(t.indexOf(e.title)>-1)return e.path_name}).filter(function(t){return t})},changeTrees:function(t){var e=[];e=t.map(function(t){return t.path_name}),this.btnList=e},saveBtns:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){var e,r,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.current_table){t.next=3;break}return this.$Message.error("请点击选中角色后操作"),t.abrupt("return");case 3:if(0!=this.btnList.length){t.next=6;break}return this.$Message.error("请选择或修改按钮后保存"),t.abrupt("return");case 6:return t.next=8,this.$service.role.putMenu({id:this.current_table.id,permIds:this.btnList});case 8:if(e=t.sent,r=e.err,n=e.data,!r){t.next=14;break}return this.$Message.error(r.message),t.abrupt("return");case 14:this.$Message.success(n.message),this.btnList=[],this.getList();case 17:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),saveMenu:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){var e,r,n,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.current_table){t.next=3;break}return this.$Message.error("请点击选中角色后操作"),t.abrupt("return");case 3:if(0!=this.menuList.length||0!=this.btnList.length){t.next=6;break}return this.$Message.error("请选择或修改菜单/功能后保存"),t.abrupt("return");case 6:return e=this.menuList.concat(this.btnList),t.next=9,this.$service.role.putMenu({id:this.current_table.id,permIds:e});case 9:if(r=t.sent,n=r.err,a=r.data,!n){t.next=15;break}return this.$Message.error(n.message),t.abrupt("return");case 15:this.$Message.success(a.message),this.menuList=[],this.getList();case 18:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),changeRadio:function(t){},hideModal:function(){this.modal_show=!1,this.clearModal()},clearModal:function(){this.form_data={role_name:"",decs:""}},checkRoleMenu:function(){var t=this,e=function e(r){return r.map(function(r){return r.children?Object(i["a"])({},r,{checked:!1,children:e(r.children)}):t.current_table.menulist.indexOf(r.path_name)>-1?Object(i["a"])({},r,{checked:!0}):Object(i["a"])({},r,{checked:!1})})}(this.menu_tree);this.menu_tree=e}}}),l=o,c=(r("5404"),r("2877")),u=Object(c["a"])(l,n,a,!1,null,null,null);u.options.__file="role.vue";e["default"]=u.exports},5404:function(t,e,r){"use strict";var n=r("105d"),a=r.n(n);a.a}}]);
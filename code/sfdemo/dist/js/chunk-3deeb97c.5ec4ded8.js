(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3deeb97c"],{a7fd:function(e,t,i){},afc1:function(e,t,i){"use strict";var a=i("a7fd"),r=i.n(a);r.a},f202:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"main_box"},[i("div",{staticClass:"top_box"}),i("div",{staticClass:"search_box"},[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"输入关键词查询",search:""},on:{"on-search":e.getList},model:{value:e.filter_keyword,callback:function(t){e.filter_keyword=t},expression:"filter_keyword"}}),i("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.goAddFile}},[e._v("新增资料")])],1),i("div",{staticStyle:{"margin-top":"20px"}},[i("Table",{attrs:{border:"",loading:e.loading,columns:e.columns,data:e.file_list},scopedSlots:e._u([{key:"file",fn:function(t){var a=t.row;t.index;return e._l(a.attachments,function(t){return i("div",[i("a",{staticClass:"file_link",attrs:{target:"_blank",href:t.url}},[e._v(e._s(t.name))])])})}},{key:"action",fn:function(t){var a=t.row;t.index;return[i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"warning",size:"small"},on:{click:function(t){e.editFile(a)}}},[e._v("编辑")]),i("Poptip",{attrs:{confirm:"",title:"确定删除此数据"},on:{"on-ok":function(t){e.remove(a)}}},[i("Button",{attrs:{type:"error",size:"small"}},[e._v("删除")])],1)]}}])}),i("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[i("Page",{attrs:{total:e.count,page:e.page,"page-size":e.page_size,"show-sizer":"","show-total":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1),i("Modal",{attrs:{"mask-closable":!1,title:"编辑资料"},model:{value:e.file_show,callback:function(t){e.file_show=t},expression:"file_show"}},[i("Form",{ref:"fileForm",attrs:{inline:"",model:e.file_model,rules:e.file_rules,"label-width":80}},[i("FormItem",{attrs:{label:"设备名称",prop:"device_id"}},[i("Select",{staticStyle:{width:"300px"},on:{"on-change":e.changeDevice},model:{value:e.file_model.equipmentName,callback:function(t){e.$set(e.file_model,"equipmentName",t)},expression:"file_model.equipmentName"}},e._l(e.deviceList,function(t){return i("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}))],1),i("FormItem",{attrs:{label:"上传资料",prop:"attachments"}},[i("Upload",{attrs:{multiple:"",type:"drag","on-success":e.showUploaded,action:e.BASE_URL+":9003/orMaterial/singleFileUpload"},on:{"on-progress":e.showUploading}},[i("div",{staticStyle:{padding:"20px 0",width:"300px"}},[i("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"md-cloud-upload",size:"42"}}),i("p",[e._v("点击或拖拽文件到此处")])],1)])],1),i("FormItem",{attrs:{label:"备注",prop:"remark"}},[i("Input",{staticStyle:{width:"350px","font-size":"10px"},attrs:{clearable:"",type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请描述出现的问题"},model:{value:e.file_model.edit_remark,callback:function(t){e.$set(e.file_model,"edit_remark",t)},expression:"file_model.edit_remark"}})],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{on:{click:e.hideFileModal}},[e._v("取消")]),i("Button",{attrs:{type:"primary"},on:{click:e.saveFile}},[e._v("确定")])],1)],1)],1)},r=[],n=i("2909"),s=i("be94"),l=(i("96cf"),i("1da1")),o=i("0a21"),c={name:"file_list",data:function(){return{BASE_URL:this.$config.BASE_URL,filter_keyword:"",file_show:!1,loading:!1,deviceList:[],columns:[{title:"ID",key:"id",align:"center"},{title:"设备名称",key:"equipmentName",align:"center"},{title:"资料(点击下载)",slot:"file",key:"attachments",align:"center"},{title:"备注",key:"remark",align:"center"},{title:"操作",slot:"action",width:130,align:"center"}],count:0,page:1,page_size:10,file_model:{equipmentName:"",equipmentId:"",edit_remark:""},file_list:[],file_lists:[],ddd:"",file_rules:{device_id:[{required:!0,message:"请选择设备",trigger:"blur",pattern:/.+/}]},order_total:1,exportLoading:!1}},mounted:function(){this.getList(),this.getAllDevice()},methods:{getAllDevice:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(){var t,i,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$service.device.getListAll();case 2:if(t=e.sent,i=t.err,a=t.data,!i){e.next=8;break}return this.$Message.error(i.message),e.abrupt("return");case 8:this.deviceList=a.data.map(function(e){return{label:e.equipmentName,value:e.id}});case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),saveFile:function(){var e=this;this.$refs["fileForm"].validate(function(t){t?e.addFile():e.$Message.error("请按要求输入")})},addFile:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(){var t,i,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={id:this.file_model.id,equipmentName:this.file_model.equipmentName,equipmentId:this.file_model.equipmentId,remark:this.file_model.remark,attachments:this.ddd},e.next=3,this.$service.file.updateList(t);case 3:if(i=e.sent,a=i.err,i.data,!a){e.next=9;break}return this.$Message.error(a.message),e.abrupt("return");case 9:this.$Message.success("Success!"),this.file_show=!1,this.getList();case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getList:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(){var t,i,a,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={search:this.filter_keyword,num:this.page,size:this.page_size},this.loading=!0,e.next=4,this.$service.file.getList(t);case 4:if(i=e.sent,a=i.err,r=i.data,this.loading=!1,!a){e.next=11;break}return this.$Message.error(a.message),e.abrupt("return");case 11:this.file_list=r.data.list.map(function(e){return{id:e.id,equipmentName:e.equipmentName||"-",remark:e.remark||"-",attachments:JSON.parse(e.attachments)}}),this.count=r.data.count;case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),changeDevice:function(e){var t=this;this.deviceList.map(function(i){i.value===e&&(t.form_data.equipmentName=i.label,t.form_data.equipmentId=i.value)})},remove:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(t){var i,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$service.file.deleteFile(t.id);case 2:if(i=e.sent,a=i.err,i.data,!a){e.next=8;break}return this.$Message.error(a.message),e.abrupt("return");case 8:this.getList();case 9:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),goAddFile:function(){this.$router.push({path:"/knowledge/add_file"})},editFile:function(e){this.file_show=!0,this.file_model=Object(s["a"])({},e,{edit_remark:e.remark})},hideFileModal:function(){this.file_show=!1,this.clearModal()},clearModal:function(){this.file_model={equipmentName:"",equipmentId:"",remark:""}},showUploading:function(e,t,i){},showUploaded:function(e){var t;(t=this.file_lists).push.apply(t,Object(n["a"])(e)),this.ddd=JSON.stringify(this.file_lists)},changePage:function(e){this.page=e,this.getList()},changePageSize:function(e){this.page=1,this.page_size=e,this.getList()},exportExcel:function(){if(this.file_list.length){this.exportLoading=!0;var e=this.columns.map(function(e){if(e.key)return e.title}).filter(function(e){return void 0!=e}),t=this.columns.map(function(e){if(e.key)return e.key}).filter(function(e){return void 0!=e}),i=this.file_list,a={title:e,key:t,data:i,autoWidth:!0,filename:"设备列表"};o["a"].export_array_to_excel(a),this.exportLoading=!1}else this.$Message.info("表格数据不能为空！")}}},u=c,d=(i("afc1"),i("2877")),f=Object(d["a"])(u,a,r,!1,null,null,null);f.options.__file="file_list.vue";t["default"]=f.exports}}]);
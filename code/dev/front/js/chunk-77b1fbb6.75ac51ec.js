(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-77b1fbb6"],{"0bf4":function(e,t,o){"use strict";var r=o("e6ff"),a=o.n(r);a.a},"0c52":function(e,t,o){},"351a":function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"main_box"},[o("div",{staticClass:"search_box"},[o("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"输入关键词查询",search:""},on:{"on-search":e.getList},model:{value:e.filter_keyword,callback:function(t){e.filter_keyword=t},expression:"filter_keyword"}}),e.btnList.indexOf("btn_addCustomer")>-1?o("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.goAddCustomer}},[e._v("新增客户")]):e._e(),o("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",loading:e.exportLoading},on:{click:e.exportExcel}},[e._v("导出EXCEL")])],1),o("div",{staticStyle:{"margin-top":"20px"}},[o("Table",{attrs:{border:"",loading:e.loading,columns:e.cusColumns,data:e.customerList},scopedSlots:e._u([{key:"action",fn:function(t){var r=t.row;t.index;return[-1!=e.btnList.indexOf("btn_editCustomer")?o("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"warning",size:"small"},on:{click:function(t){e.editCustomer(r)}}},[e._v("编辑")]):e._e(),o("Poptip",{attrs:{confirm:"",title:"确定删除此客户"},on:{"on-ok":function(t){e.remove(r)}}},[-1!=e.btnList.indexOf("btn_deleteCustomer")?o("Button",{attrs:{type:"error",size:"small"}},[e._v("删除")]):e._e()],1)]}}])}),o("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[o("Page",{attrs:{total:e.count,page:e.page,"page-size":e.page_size,"show-sizer":"","show-total":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1),o("Modal",{attrs:{"mask-closable":!1,title:"编辑客户"},model:{value:e.customer_show,callback:function(t){e.customer_show=t},expression:"customer_show"}},[o("Form",{ref:"customerForm",attrs:{inline:"",model:e.editCustomerForm,rules:e.customer_rules,"label-width":95}},[o("FormItem",{attrs:{label:"客户名称",prop:"edit_companyName"}},[o("Input",{staticStyle:{width:"300px"},attrs:{clearable:""},model:{value:e.editCustomerForm.edit_companyName,callback:function(t){e.$set(e.editCustomerForm,"edit_companyName",t)},expression:"editCustomerForm.edit_companyName"}})],1),o("FormItem",{attrs:{label:"客户地址",prop:"address"}},[o("Input",{staticStyle:{width:"300px"},attrs:{readonly:""},on:{"on-focus":e.showMapModal},model:{value:e.editCustomerForm.address,callback:function(t){e.$set(e.editCustomerForm,"address",t)},expression:"editCustomerForm.address"}})],1),o("FormItem",{attrs:{label:"联系人",prop:"edit_costomName"}},[o("Input",{staticStyle:{width:"300px"},attrs:{clearable:""},model:{value:e.editCustomerForm.edit_costomName,callback:function(t){e.$set(e.editCustomerForm,"edit_costomName",t)},expression:"editCustomerForm.edit_costomName"}})],1),o("FormItem",{attrs:{label:"联系电话",prop:"edit_mobile"}},[o("Input",{staticStyle:{width:"300px"},attrs:{clearable:""},model:{value:e.editCustomerForm.edit_mobile,callback:function(t){e.$set(e.editCustomerForm,"edit_mobile",t)},expression:"editCustomerForm.edit_mobile"}})],1),o("FormItem",{attrs:{label:"故障响应时间",prop:"dealcycle"}},[o("Select",{staticStyle:{width:"300px"},model:{value:e.editCustomerForm.dealcycle,callback:function(t){e.$set(e.editCustomerForm,"dealcycle",t)},expression:"editCustomerForm.dealcycle"}},e._l(e.dealCycleList,function(t){return o("Option",{key:t.value,attrs:{value:t.label}},[e._v(e._s(t.label+"小时"))])}))],1),o("FormItem",{attrs:{label:"备注",prop:"edit_note"}},[o("Input",{staticStyle:{width:"300px","font-size":"10px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入备注",clearable:""},on:{"on-change":e.changeInput},model:{value:e.editCustomerForm.edit_note,callback:function(t){e.$set(e.editCustomerForm,"edit_note",t)},expression:"editCustomerForm.edit_note"}})],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{on:{click:e.hideCustomerModal}},[e._v("取消")]),o("Button",{attrs:{type:"primary"},on:{click:e.saveCheck}},[e._v("确定")])],1)],1),o("CustomerMap",{ref:"customerMap",attrs:{companyName:e.editCustomerForm.edit_companyName},on:{"update:companyName":function(t){e.$set(e.editCustomerForm,"edit_companyName",t)},setLocation:e.setLocation}})],1)},a=[],s=o("be94"),i=(o("96cf"),o("1da1")),n=o("9a93"),c=o("90de"),m=o("0a21"),u={name:"customer",components:{CustomerMap:n["a"]},data:function(){var e=function(e,t,o){if(!t)return o(new Error("联系电话不允许为空"));Object(c["a"])(t)||Object(c["b"])(t)?o():o("请填写手机号码或固定电话")};return{btnList:[],loading:!1,filter_keyword:"",customer_show:!1,editCustomerForm:{id:"",edit_companyName:"",edit_costomName:"",area:"",address:"",edit_mobile:"",edit_note:"",dealcycle:"",currentLng:"",currentLat:""},customer_rules:{edit_companyName:[{required:!0,message:"客户名称不允许为空",trigger:"blur"}],address:[{required:!0,message:"客户地址不允许为空",trigger:"change"}],edit_costomName:[{required:!0,message:"联系人不允许为空",trigger:"blur"}],edit_mobile:[{required:!0,validator:e,trigger:"blur"}],dealcycle:[{required:!0,message:"请选择故障响应时间",trigger:"change"}]},cusColumns:[{title:"客户名称",key:"companyName",align:"center"},{title:"客户地址",key:"address",align:"center"},{title:"联系人",key:"costomName",align:"center",width:120},{title:"联系电话",key:"mobile",align:"center",width:130},{title:"备注",key:"note",align:"center"},{title:"操作",slot:"action",width:130}],customerList:[],page:1,page_size:10,count:1,dealCycleList:[],exportLoading:!1}},mounted:function(){this.getList()},methods:{changeInput:function(){},getList:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,o,r,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={search:this.filter_keyword,num:this.page,size:this.page_size},this.loading=!0,e.next=4,this.$service.customer.getList(t);case 4:if(o=e.sent,r=o.err,a=o.data,this.loading=!1,!r){e.next=11;break}return this.$Message.error(r.message),e.abrupt("return");case 11:this.customerList=a.data.list,this.count=a.data.count,this.btnList=sessionStorage.getItem("btnList");case 14:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),remove:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var o,r,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$service.customer.deleteCustomer(t.id);case 2:if(o=e.sent,r=o.err,a=o.data,!r){e.next=8;break}return this.$Message.error(r.message),e.abrupt("return");case 8:this.$Message.success(a.message),this.getList();case 10:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),changePage:function(e){this.page=e,this.getList()},changePageSize:function(e){this.page=1,this.page_size=e,this.getList()},goAddCustomer:function(){this.$router.push({path:"/customer/add_customer"})},saveCheck:function(){var e=this;this.$refs["customerForm"].validate(function(t){t?e.saveCustomer():e.$Message.error("请按要求输入")})},saveCustomer:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,o,r,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={id:this.editCustomerForm.id,companyName:this.editCustomerForm.edit_companyName,address:this.editCustomerForm.address,costomName:this.editCustomerForm.edit_costomName,mobile:this.editCustomerForm.edit_mobile,note:this.editCustomerForm.edit_note,area:this.editCustomerForm.area,addressX:this.editCustomerForm.currentLat,addressY:this.editCustomerForm.currentLng,dealcycle:this.editCustomerForm.dealcycle},e.next=3,this.$service.customer.updateList(t);case 3:if(o=e.sent,r=o.err,a=o.data,!r){e.next=9;break}return this.$Message.error(r.message),e.abrupt("return");case 9:this.$Message.success(a.message),this.customer_show=!1,this.getList();case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),editCustomer:function(e){this.customer_show=!0,this.editCustomerForm=Object(s["a"])({},e,{edit_companyName:e.companyName,edit_costomName:e.costomName,edit_mobile:e.mobile,edit_note:e.note}),this.getDealCycleList()},hideCustomerModal:function(){this.customer_show=!1,this.clearModal()},clearModal:function(){this.editCustomerForm={id:"",edit_companyName:"",edit_costomName:"",area:"",address:"",edit_mobile:"",edit_note:"",dealcycle:"",currentLng:"",currentLat:""}},showMapModal:function(){this.editCustomerForm.companyName.length<2?this.$Message.error("请输入客户完整名称"):this.$refs["customerMap"].show()},setLocation:function(e){this.editCustomerForm.currentLng=e.point.lng,this.editCustomerForm.currentLat=e.point.lat,this.editCustomerForm.address=e.address,e.province&&e.city&&(this.editCustomerForm.area="".concat(e.province).concat(e.city)),this.$refs["customerMap"].hide()},getDealCycleList:function(){this.dealCycleList=[{label:"2",value:1},{label:"4",value:2},{label:"8",value:3}]},exportExcel:function(){if(this.customerList.length){this.exportLoading=!0;var e=this.cusColumns.map(function(e){if(e.key)return e.title}).filter(function(e){return void 0!=e}),t=this.cusColumns.map(function(e){if(e.key)return e.key}).filter(function(e){return void 0!=e}),o=this.customerList,r={title:e,key:t,data:o,autoWidth:!0,filename:"客户列表"};m["a"].export_array_to_excel(r),this.exportLoading=!1}else this.$Message.info("表格数据不能为空！")}}},l=u,d=(o("0bf4"),o("2877")),p=Object(d["a"])(l,r,a,!1,null,null,null);p.options.__file="customer_list.vue";t["default"]=p.exports},"9a93":function(e,t,o){"use strict";var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("Modal",{attrs:{title:"标记客户地址"},model:{value:e.mapShow,callback:function(t){e.mapShow=t},expression:"mapShow"}},[o("div",{staticClass:"map_container_box"},[o("Input",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{placeholder:"请输入客户完整名称",search:"","enter-button":""},on:{"on-search":e.changeMapKeyword},model:{value:e.mapKeyword,callback:function(t){e.mapKeyword=t},expression:"mapKeyword"}}),o("baidu-map",{staticClass:"map_box",attrs:{center:e.center,zoom:15,"scroll-wheel-zoom":!0}},[o("bm-boundary",{attrs:{name:"菏泽市",strokeWeight:2,strokeColor:"blue",fillColor:"rgba(0,0,0,0)"}}),o("bm-map-type",{attrs:{"map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP"],anchor:"BMAP_ANCHOR_TOP_LEFT"}}),o("bm-local-search",{attrs:{keyword:e.searchKeyword,panel:!1,autoViewport:!0,location:e.searchLocation},on:{infohtmlset:e.changeMapMarket}})],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{on:{click:e.hide}},[e._v("取消")]),o("Button",{attrs:{type:"primary"},on:{click:e.selectMarket}},[e._v("确定")])],1)])},a=[],s={name:"customerMap",props:{companyName:{type:String,default:""}},watch:{mapKeyword:function(e,t){this.$emit("update:companyName",e)}},data:function(){return{mapShow:!1,center:{lng:115.479973,lat:35.23341},mapKeyword:"",searchKeyword:"",searchLocation:"菏泽",currentLocation:""}},methods:{show:function(){this.mapShow=!0,this.mapKeyword=this.companyName,this.searchKeyword=this.mapKeyword},hide:function(){this.mapShow=!1,this.currentLocation=""},changeMapMarket:function(e){console.log(e),this.currentLocation=e},changeMapKeyword:function(e){this.searchKeyword=e},selectMarket:function(){this.currentLocation?this.$emit("setLocation",this.currentLocation):this.$Message.error("请点击选定客户地址")}}},i=s,n=(o("e7b4"),o("2877")),c=Object(n["a"])(i,r,a,!1,null,"5bef249b",null);c.options.__file="customer-map.vue";t["a"]=c.exports},e6ff:function(e,t,o){},e7b4:function(e,t,o){"use strict";var r=o("0c52"),a=o.n(r);a.a}}]);
<!DOCTYPE html>
<html class="no-js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no,initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
<meta name="keywords" content="" /> 
<meta name="description" content="">
<link rel="stylesheet" type="text/css" href="font/iconfont.css">
<link type="text/css" rel="stylesheet" href="css/public.css" />
<link type="text/css" rel="stylesheet" href="css/index.css" />
	<!-- 引入样式 -->
	<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
	<script src="js/vue.js" type="text/javascript"></script>
	<script src="js/util.js" type="text/javascript"></script>
	<script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="./js/jquery.min.js"></script>
  <script src="./js/jquery.binarytransport.js"></script>
  <script src="js/my.js" type="text/javascript"></script>
<title>已签预览</title>

<body>
	<div id="app">
		<header class="other_header">
			<div class="head_box">
				<a href="./yq_hetong.html" class="head_left"><i class="iconfont">&#xe6d9;</i></a>
				<span>已签预览</span>
				<a href="" class="head_right"></a>
			</div>
		</header>
    <section>
			<div class="already_text">
				<div class="already_top">
					<span>合同编号：1254656464</span>
					<h1>载莜道科技劳动合同</h1>
				</div>
			</div>
			<div class="contract_nav">
				<p>出租方（甲方）姓名：_______ 身份证号：_______ </p>
				<p>出租方（甲方）姓名：_______ 身份证号：_______ </p>
				<p></p>
				<p>出租方（甲方）姓名：_______ 身份证号：_______ </p>
				<p>出租方（甲方）姓名：_______ 身份证号：_______ </p>
			</div>
		</section>
		<div class="enclosure public_ul">
			<ul>
				<li class="one">
					<a href="ht_fujian.html"><i class="iconfont">&#xe7af;</i>附件1</a>
				</li>
				<li class="one">
					<a href="ht_fujian.html"><i class="iconfont">&#xe7af;</i>附件1</a>
				</li>
				<li class="two">
					<a href="javascript:;" @click="downloadFile"><i class="iconfont">&#xe7b0;</i>下载</a>
				</li>
			</ul>
		</div>
    <div class="loading_box" v-if="loading">
      <div class="loader loader--style1" title="0">
        <svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   width="40px" height="40px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve">
  <path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946
    s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634
    c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"/>
  <path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0
    C22.32,8.481,24.301,9.057,26.013,10.047z">
    <animateTransform attributeType="xml"
      attributeName="transform"
      type="rotate"
      from="0 20 20"
      to="360 20 20"
      dur="0.5s"
      repeatCount="indefinite"/>
    </path>
  </svg>
      </div>
    </div>
	</div>
	<script>
		var app = new Vue({
			el: '#app',
			data:{
			  loading: false,
				xid: '',
			},
			mounted(){
			  this.getId()
			},
			methods:{
        // 判断是否有xid
        getId(){
          const that = this
          that.xid = sessionStorage.getItem('xid')
          if(!that.xid){
            that.$message.error('未知用户，请重新登录')
            setTimeout(()=>{
              window.location = './login.html'
            },1500)
          }
        },
        //下载
        downloadFile(){
          const that = this;
          const id = getUrlKey('id')
          that.loading = true
          $.ajax({
            type: "GET",
            cache: false,
            crossDomain: true,
            contentType: 'application/json',
            headers: {
              'x-dc-uid': 'bc7ad38f-03a1-4a4e-a46d-9cef677a2d3a'
            },
            // beforeSend: function(xhr) {
            //   xhr.setRequestHeader("x-dc-uid", that.xid);
            // },
            url: `${HOST1}/session/dc9df4e2-69ed-4753-a702-19e648089473/download`,
            dataType: 'binary',
            processData: false,
            success: function(result) {
              that.loading = false
              var url = URL.createObjectURL(result);
              var $a = $('<a />', {
                'href': url,
                'download': 'contract.docx',
                'text': "click"
              }).hide().appendTo("body")[0].click();
              setTimeout(function() {
                URL.revokeObjectURL(url);
              }, 10000);
            },
						fail:(res)=>{
              that.loading = false
            }
          });

        },
        dataURLtoFile(dataurl, filename) {
          var arr = dataurl.split(',');
          console.log(arr[1]);return;
            bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
          while(n--){
            u8arr[n] = bstr.charCodeAt(n);
          }
          const a = new File([u8arr], filename, {type:mime});
          console.log(a)
        },
				file(){
          const that = this
					that.dataURLtoFile(that.fileUrl,'合同',)
					return
          var eleLink = document.createElement('a');
          eleLink.download = '合同';
          eleLink.style.display = 'none';
          var blob = new Blob([u8arr], {
            type: "application/msword"
          });
          eleLink.href = URL.createObjectURL(blob);
          // 触发点击
          document.body.appendChild(eleLink);
          eleLink.click();
          // 然后移除
          document.body.removeChild(eleLink);

          // const that = this
          // let blob = new Blob([that.fileUrl], {
          //   type: "application/msword"
          // });
          // let url = URL.createObjectURL(blob);
          // let link = document.createElement('a');
          // link.setAttribute("href", url);
          // link.setAttribute("download", `word.docx`);
          // link.style.visibility = 'hidden';
          // document.body.appendChild(link);
          // link.click();
          // document.body.removeChild(link);
				},
				//
				getUserInfo(){
          $.ajax({
            type:"get",
            url: `https://ec2-18-209-228-104.compute-1.amazonaws.com:8443/v1/user`,
            dataType: "json",
            ContentType: "application/json",
            data:{
              email :'17852909766@netLaw.com'
            },
            success:(res)=>{
              console.log(res);
            }
          })
				},
        setWord(){
          const that = this
          const id = getUrlKey('id')
          that.loading = true
          $.ajax({
            type:"get",
            url: `https://ec2-18-209-228-104.compute-1.amazonaws.com:8443/v1/compute/${id}`,
            dataType: "json",
            ContentType: "application/json",
						data:{
              session_id: id
            },
            headers:{
              'X-DC-UID':that.xid
            },
            success:(res)=>{
              console.log(res);
              that.getWord()
            }
          })
        },
			  // 获取合同预览
        getWord(){
          const that = this
					const id = getUrlKey('id')
          that.loading = true
          $.ajax({
            type:"get",
            url: `${HOST1}session/dc9df4e2-69ed-4753-a702-19e648089473/download`,
            dataType: "json",
            ContentType: "application/json",
            beforeSend: function (XMLHttpRequest) {
            	XMLHttpRequest.setRequestHeader('x-dc-uid', 'bc7ad38f-03a1-4a4e-a46d-9cef677a2d3a');
            },
						headers:{
              'X-DC-UID':'bc7ad38f-03a1-4a4e-a46d-9cef677a2d3a'
						},
            success:(res)=>{
              console.log(res);
              that.dataURLtoFile(res,'合同',)
            }
          })
          return
          network({
            params: {
              "session_id ": id
            },
            path: `session/${id}/download`,
            method: 'get',
            head: [
              "Content-Type: application/json",
              `x-dc-uid: ${that.xid}`
            ],
            success: function (e) {
              that.loading = false
              const data = JSON.parse(e);
              console.log(data)
            }
          })
        },
			}
		})
	</script>
</body>
</html>